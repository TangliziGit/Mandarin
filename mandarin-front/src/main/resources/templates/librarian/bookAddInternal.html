<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
  <title>Purple Admin</title>
    <th:block th:replace="librarian/common :: head"></th:block>
</head>

<body>
  <div class="container-scroller">
    <!-- partial:../../partials/_navbar.html -->
      <div th:replace="librarian/common :: navbar"></div>
    <!-- partial -->
    <div class="container-fluid page-body-wrapper">
      <div class="row row-offcanvas row-offcanvas-right">
        <!-- partial:../../partials/_sidebar.html -->
       <nav class="sidebar sidebar-offcanvas" id="sidebar">
          <ul class="nav">
            <li class="nav-item">
              <a class="nav-link" href="index.html">
                <span class="menu-title">Home</span>
             
                <i class="mdi mdi-home menu-icon"></i>
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" data-toggle="collapse" href="#ui-basic" aria-expanded="false" aria-controls="ui-basic">
                <span class="menu-title">Reader Manage</span>
                <i class="menu-arrow"></i>
                <i class="mdi mdi-crosshairs-gps menu-icon"></i>
              </a>
              <div class="collapse" id="ui-basic">
                <ul class="nav flex-column sub-menu">
                  <li class="nav-item"> <a class="nav-link" href="register.html">Register</a></li>
                  <li class="nav-item"> <a class="nav-link" href="deleteReader.html">Reader Delete</a></li>
                       <li class="nav-item"> <a class="nav-link" href="updateReader.html">ReaderUpdate</a></li>
                </ul>
                </div>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="category.html">
                <span class="menu-title">Category Manage</span>
                <i class="mdi mdi-contacts menu-icon"></i>
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="bookManage.html">
                <span class="menu-title">Book Manage</span>
                <i class="mdi mdi-format-list-bulleted menu-icon"></i>
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="history.html">
                <span class="menu-title">Delete History</span>
                <i class="mdi mdi-chart-bar menu-icon"></i>
              </a>
            </li>
            </ul>




        </nav>
        <!-- partial -->
        <div class="content-wrapper">
       
          <div class="row">
         <!--    <div class="col-md-6 d-flex align-items-stretch grid-margin">
              <div class="row flex-grow"> -->
                      
                <div class="col-12 grid-margin">
                  <div class="card">
                    <div class="card-body">
                      <h4 class="card-title">Book Add by Internal ID</h4>
                      <p class="card-description">
                        Please add the book by Assign internal ID. 
                      </p>
                      <div class="container-fluid">
                       <div class="form-group row">
                          <label for="exampleInputtext2" class="col-sm-3 col-form-label">ISBN</label>
                          <div class="col-sm-9"><input type="text" class="form-control" id="isbn" placeholder="Enter the ISBN"></div>
                           
                        </div>
                        <div class="form-group row">
                          <label for="exampleInputPassword2" class="col-sm-3 col-form-label">title</label>
                          <div class="col-sm-9">
                           
                            <input type="text" class="form-control" id="title" placeholder="Enter the title">
                          </div>
                        </div>
                               <div class="form-group row">
                          <label for="exampleInputtext2" class="col-sm-3 col-form-label">author</label>
                          <div class="col-sm-9">
                            <input type="text" class="form-control" id="author" placeholder="Enter the author">
                          </div>
                        </div>
                        <div class="form-group row">
                          <label for="exampleInputPassword2" class="col-sm-3 col-form-label">price</label>
                          <div class="col-sm-9">
                            <input type="number" class="form-control" id="price" placeholder="Enter the price">
                              <small style="color: grey">must be a number</small>
                          </div>
                        </div>
                         <div class="form-group row">
                          <label for="exampleInputtext2" class="col-sm-3 col-form-label">location</label>
                          <div class="col-sm-9">
                            <input type="text" class="form-control" id="location" placeholder="Enter the location">
                          </div>
                        </div>

                       <div class="form-group row">
                          <label for="exampleInputtext2" class="col-sm-3 col-form-label">categoryName</label>
                          <div class="col-sm-9">
                            <input type="text" class="form-control" id="categoryName" placeholder="Enter the categoryName">
                              <small style="color: grey">category must exist</small>
                          </div>
                        </div>
                                                <div class="form-group row">
                          <label for="exampleInputtext2" class="col-sm-3 col-form-label">publishYear</label>
                          <div class="col-sm-9">
                            <input type="number" class="form-control" id="publishYear" placeholder="Enter the publishYear">
                              <small style="color: grey">must be a number</small>
                          </div>
                        </div>
                                                <div class="form-group row">
                          <label for="exampleInputtext2" class="col-sm-3 col-form-label">publisher</label>
                          <div class="col-sm-9">
                            <input type="text" class="form-control" id="publisher" placeholder="Enter the publisher">
                          </div>
                        </div>
                          <div class="form-group row">
                          <label for="exampleInputtext2" class="col-sm-3 col-form-label">summary</label>
                          <div class="col-sm-9">
                            <input type="text" class="form-control" id="summary" placeholder="Enter the summary">
                          </div>
                        </div>
                        <div class="form-group row">
                          <label for="exampleInputPassword2" class="col-sm-3 col-form-label">copyNumber</label>
                          <div class="col-sm-9">
                            <input type="number" class="form-control" id="copyNumber" placeholder="Enter the copyNumber">
                              <small style="color: grey">must be a number</small>
                          </div>
                        </div>

                        <button  class="btn btn-success mr-2" onclick="insert()">Submit</button>
                        </div>
</div>
</div>
</div>
  <div class="col-12 grid-margin">
    <div class="card">
                        <div class="container-fluid">
                          <div class="card-body" >
                          <h4 class="card-title">Result</h4>
                          <div id="barcode">
                            <!-- img id="imgcode"/ -->
                          </div>
                          <div id="list"></div>
                         </div>
</div>
</div>
</div>
                      
                    </div>
                  </div>

        <!-- content-wrapper ends -->
        <!-- partial:../../partials/_footer.html -->
          <div th:replace="librarian/common :: footer"></div>
        <!-- partial -->
      </div>
      <!-- row-offcanvas ends -->
    </div>
    <!-- page-body-wrapper ends -->
  </div>
  <!-- container-scroller -->
  <!-- End custom js for this page-->
  <div th:replace="librarian/common :: scripts"></div>
  <script>
      function getUrlParam(name) {
          var reg = new RegExp("(^|&)"+ name +"=([^&]*)(&|$)");
          var r = window.location.search.substr(1).match(reg);//search,查询？后面的参数，并匹配正则
          if(r!=null)
              return unescape(r[2]);
          return null;
      }

      var isbn=getUrlParam("isbn");
      if (isbn!=null){
          $.ajax({
              url:"http://106.13.1.40:8081/isbn/"+isbn,
              type:"get",
              dataType:"json",
              success:function(resp){
                  console.log(resp);

                  $("#isbn").val(isbn);
                  $("#title").val(resp.title);
                  $("#author").val(resp.author);
                  $("#price").val(resp.price);
                  $("#location").val("");
                  $("#categoryName").val("");
                  $("#publishYear").val(resp.publishYear);
                  $("#publisher").val(resp.publisher);
                  $("#summary").val(resp.summary);
                  $("#copyNumber").val("");
              },
              error:function (resp) {
                  alert(resp.responseJson.message);
              }
          });
      }

      function insert(){

//         $("#imgcode").JsBarcode($("#isbn").val());
        var ISBN = $("#isbn").val();
        var title = $("#title").val();
        var author = $("#author").val();
        var price = $("#price").val();
        var location = $("#location").val();
        var categoryName = $("#categoryName").val();
        var publishYear = $("#publishYear").val();
        var publisher = $("#publisher").val();
        var summary = $("#summary").val();
        var copyNumber = $("#copyNumber").val();
          $('#list').html("<h4>You add books successfully</h4>"+
          // "<p>ISBN : "+ISBN+"</p>"+ "<p>title : "+title+"</p>"+ "<p>author : "+author+"</p>"+
           // "<p>price : "+price+"</p>"+ "<p>location : "+location+"</p>"+ "<p>categoryName : "+categoryName+"</p>"+ "<p>publishYear : "+publishYear+"</p>"+ "<p>publisher : "+publisher+"</p>"+ "<p>summary : "+summary+"</p>"+ "<p>copyNumber : "+copyNumber+"</p>"
          "");
        var data = {
            "ISBN":ISBN,
            "title":title,
            "author":author,
            "price":price,
            "location":location,
            "categoryName":categoryName,
            "publishYear":publishYear,
            "publisher":publisher,
            "summary":summary,
            "copyNumber":copyNumber
        };

        function padNumber(num){
            num=""+num
            for (var i=num.length; i<10; i++)
                num="0"+num;
            return num
        }

        $.ajax({
          url:"/api/book",
          type:"post",
          dataType:"json",
          data: getFormData(data),
          processData: false,
          contentType: false,
          success:function(data){
                console.log(data);
                alert("success");
                for (elem of data.data){
                    console.log(elem);

                    var key='barcode_img'+elem;
                    $("<img />", {
                        id: key
                    }).appendTo($("#barcode"));
                    $("#"+key).JsBarcode(padNumber(elem));
                }
            },
           error:function (data) {
              console.log(data);
               alert(data.responseJSON.message);
            }
        });
      }
    </script>
    
</body>

</html>
